---
title: "Cyclistic Rider Behavior Cleaning Report"
author: "JohnPaul Medina"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
source(here::here("simulation/simConfig.R"))
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction
Data cleaning is a critical step in any data analysis project. The accuracy and reliability of insights depend on the quality of the underlying data.    

> **Project Documentation**:  
> View the full **cleaning, EDA, and changelog logs**  
> [Click here](https://docs.google.com/spreadsheets/d/e/2PACX-1vRsdTcZUKUd6BXzZpSvwYAP8hJBCRDVilBmd9sOeeCMLLNRvnmaT5X8OIv_txawY_CcYy0frfpHOpTK/pubhtml)

## Initial Dataset Exploration and Verification
* This script is written as introductory exploration of datasets for familiarity 
and understanding.
* After initial exploration, the script checks if every column in every dataset 
contains the same column name. 
* Finally, the script checks if all of the corresponding columns of every
dataset is of the same data type.

### Initial view of first dataset
To familiarize ourselves with the dataset structure, we first load a single file 
to examine its column names and data types.
```{r initial dataset exploration 1}
# Load the first dataset for initial survey of column characteristics
jan_2024 <- read.csv(file.path(sim_raw_data_dir,"202401-divvy-tripdata.csv"))

# Display the column names and their respective data types. 
str(jan_2024)
```
### Check Column Name Consistency Across Datasets
Each dataset spans 13 months (Jan 2024 - Jan 2025). Before merging, we must 
verify that all datasets contain identical column names to prevent mismatches.
```{r Column name consistency check}
check_column_names <- function(directory){
  # Compile all the raw dataset into a list
  raw_files <- list.files(path=sim_raw_data_dir, pattern = "*.csv",
                          full.names = TRUE)
  # Read the column names for each file
  column_names_list <- lapply(raw_files, 
                              function(file) colnames(read.csv(file, nrows=1)))
  
  # Check if all datasets have the same column names
  # Unique function removes all duplicates except for the first one.
  unique_columns <- unique(column_names_list)
  
  # If there is only one left in the list, then all column names match
  if(length(unique_columns)==1){
    print("All datasets have consistent column names.")
  }else{
    print("Column name mismatch found!")
    # Print each unique column set separately for clarity
    for(i in seq_along(unique_columns)){
      cat("\nUnique Column Set",i,":\n")
      print(unique_columns[[i]])
    }
  }
}
# Call the function
check_column_names(sim_raw_data_dir)

```

### Check Consistent Column Data Type
Ensuring each column retains the same data type across all datasets prevents 
compatibility issues when merging.
```{r Column data type check}
# This function checks if all the data types of corresponding columns in each
# of the datasets are the same.
check_data_types <- function(directory){
  # List of all csv files
  files <- list.files(path=directory, pattern = "*.csv", full.names=TRUE)
  
  # Read and check column data types for each file
  data_types_list <- lapply(files, function(file){
    df <- read.csv(file, na.strings = c("","NA")) # Treat empty strings as NA
    sapply(df,class) # Get the data types
  })
  
  # Check if all the datasets have consistent data types
  unique_data_types <- unique(data_types_list)
  
  if (length(unique_data_types) == 1) {
    print("All datasets have consistent data types.")
  } else {
    print("Data type mismatch detected! Showing unique data types:")
    print(unique_data_types)
  }
}
# Run the function
check_data_types(sim_raw_data_dir)
```


